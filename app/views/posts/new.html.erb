<h1 class="text-2xl font-bold text-[#2D4F4B] text-center mb-8">新しい投稿</h1>

<div class="max-w-4xl mx-auto">
  <div class="bg-[#FFFCF4] border border-[#F0EAD6] rounded-lg p-6 mb-6 shadow">
    <% if @post.errors.any? %>
      <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
        <h2 class="text-red-600 font-semibold mb-2">投稿にエラーがあります:</h2>
        <ul class="list-disc list-inside text-red-600">
          <% @post.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

  <%= form_with model: @post, local: true, data: { turbo: false } do |form| %>
      <div class="mb-6">
        <%= form.label :title, "タイトル", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>
        <%= form.text_field :title, class: "w-full px-3 py-2 border border-[#F0EAD6] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4AA398] focus:border-transparent" %>
      </div>

      <div class="mb-6">
        <%= form.label :body, "本文", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>
        <%= form.text_area :body, rows: 5, class: "w-full px-3 py-2 border border-[#F0EAD6] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4AA398] focus:border-transparent" %>
      </div>

      <div class="mb-6">
        <%= form.label :post_image, "写真", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>

      <div class="mb-4">
          <%= form.file_field :post_image,
              accept: "image/*",
              class: "hidden",
              id: "post_image_input",
              onchange: "updateLabel(this)" %>

          <label for="post_image_input" class="w-full px-4 py-3 border-2 border-dashed border-[#4AA398] rounded-lg bg-[#F8FFFE] hover:bg-[#F0FFFE] transition-colors duration-200 cursor-pointer text-center block">
            <div class="flex items-center justify-center space-x-2">
              <span class="text-2xl">📷</span>
              <span class="text-[#2D4F4B] font-medium" id="upload_text">写真を選択</span>
            </div>
            <p class="text-sm text-[#7A736A] mt-1" id="upload_desc">クリックしてファイルを選択してください</p>
          </label>
        </div>
        <%= form.hidden_field :post_image_cache %>
      </div>

      <div class="flex justify-center mt-8">
        <%= form.submit "投稿する", class: "btn px-6 py-3 w-64 text-lg shadow-lg text-white bg-[#EF6C00] hover:bg-[#d95f00] transition-colors duration-200 flex items-center justify-center leading-none" %>
      </div>
  <% end %>
  </div>
</div>

<div class="flex justify-center mt-4">
  <%= link_to "戻る", posts_path, class: "btn px-6 py-3 w-64 text-lg shadow-lg text-white bg-[#4AA398] hover:bg-[#3e8f8e] transition-colors duration-200" %>
</div>

<script>
function updateLabel(input) {
  const uploadText = document.getElementById("upload_text");
  const uploadDesc = document.getElementById("upload_desc");

  if (input.files && input.files[0]) {
    uploadText.textContent = "選択済み: " + input.files[0].name;
    uploadDesc.textContent = "別のファイルを選択する場合はクリック";
  } else {
    uploadText.textContent = "写真を選択";
    uploadDesc.textContent = "クリックしてファイルを選択してください";
  }
}
</script>