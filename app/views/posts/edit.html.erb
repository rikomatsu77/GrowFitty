<h1 class="text-2xl font-bold text-[#2D4F4B] text-center mb-8">æŠ•ç¨¿å†…å®¹ã®ç·¨é›†</h1>

<div class="max-w-4xl mx-auto">
<div class="bg-[#FFFCF4] border border-[#F0EAD6] rounded-lg p-6 mb-6 shadow">
  <% if @post.errors.any? %>
    <div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
      <h2 class="text-red-600 font-semibold mb-2">æŠ•ç¨¿ã«ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™:</h2>
      <ul class="list-disc list-inside text-red-600">
        <% @post.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%= form_with model: @post, local: true, data: { turbo: false } do |form| %>
    <div class="mb-6">
      <%= form.label :title, "ã‚¿ã‚¤ãƒˆãƒ«", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>
      <%= form.text_field :title, class: "w-full px-3 py-2 border border-[#F0EAD6] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4AA398] focus:border-transparent" %>
    </div>

    <div class="mb-6">
      <%= form.label :body, "æœ¬æ–‡", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>
      <%= form.text_area :body, rows: 5, class: "w-full px-3 py-2 border border-[#F0EAD6] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4AA398] focus:border-transparent" %>
    </div>

    <!-- å†™çœŸç·¨é›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="mb-6">
      <%= form.label :post_image, "å†™çœŸ", class: "block text-sm font-medium text-[#2D4F4B] mb-2" %>

      <!-- ç¾åœ¨ã®å†™çœŸè¡¨ç¤º -->
      <% if @post.post_image.present? %>
        <div class="mb-3">
          <p class="text-sm text-[#7A736A] mb-2">ç¾åœ¨ã®å†™çœŸ:</p>
          <div class="w-48 h-32 bg-gray-50 rounded-lg overflow-hidden shadow-sm flex items-center justify-center border border-[#F0EAD6]">
            <%= image_tag @post.post_image.url,
                alt: "ç¾åœ¨ã®å†™çœŸ",
                class: "max-w-full max-h-full object-contain" %>
          </div>
        </div>
      <% else %>
        <p class="text-sm text-[#7A736A] mb-2">ç¾åœ¨å†™çœŸã¯è¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
      <% end %>

      <!-- æ–°ã—ã„å†™çœŸã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
      <div class="mb-4">
  <%= form.file_field :post_image,
      accept: "image/*",
      class: "hidden",
      id: "post_image_input",
      onchange: "updateLabel(this)" %>

  <label for="post_image_input" class="w-full px-4 py-3 border-2 border-dashed border-[#4AA398] rounded-lg bg-[#F8FFFE] hover:bg-[#F0FFFE] transition-colors duration-200 cursor-pointer text-center block">
    <div class="flex items-center justify-center space-x-2">
      <span class="text-2xl">ğŸ“·</span>
      <span class="text-[#2D4F4B] font-medium" id="upload_text">æ–°ã—ã„å†™çœŸã‚’é¸æŠ</span>
    </div>
    <p class="text-sm text-[#7A736A] mt-1" id="upload_desc">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„</p>
  </label>
</div>

<%= form.hidden_field :post_image_cache %>

<script>
function updateLabel(input) {
  const uploadText = document.getElementById("upload_text");
  const uploadDesc = document.getElementById("upload_desc");

  if (input.files && input.files[0]) {
    uploadText.textContent = "é¸æŠæ¸ˆã¿: " + input.files[0].name;
    uploadDesc.textContent = "åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹å ´åˆã¯ã‚¯ãƒªãƒƒã‚¯";
  } else {
    uploadText.textContent = "æ–°ã—ã„å†™çœŸã‚’é¸æŠ";
    uploadDesc.textContent = "ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„";
  }
}
</script>

    <div class="flex justify-center mt-8">
      <%= form.submit "æ›´æ–°", class: "btn px-6 py-3 w-64 text-lg shadow-lg text-white bg-[#EF6C00] hover:bg-[#d95f00] transition-colors duration-200 flex items-center justify-center leading-none" %>
    </div>
  <% end %>
  </div>
</div>
    <div class="flex justify-center mt-4">
      <%= link_to "è©³ç´°ã«æˆ»ã‚‹", post_path(@post), class: "btn px-6 py-3 w-64 text-lg shadow-lg text-white bg-[#4AA398] hover:bg-[#3e8f8e] transition-colors duration-200" %>
    </div>
